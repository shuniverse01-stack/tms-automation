name: TMS PS1 Only (Visible)

on:
  workflow_dispatch: {}     # 수동 실행 → 즉시 1회 실행
  schedule:
    - cron: "0 * * * *"  # 1시간 간격

concurrency:
  group: tms-ps1-only
  cancel-in-progress: true

jobs:
  run-local-ps1:
    runs-on: [self-hosted, Windows]
    defaults:
      run:
        shell: powershell

    steps:
      - name: Run local PS1 in a VISIBLE PowerShell window (exact commands)
        run: |
          # 요청하신 두 줄을 그대로 실행:
          # 1) cd D:\appium_project
          # 2) powershell -ExecutionPolicy Bypass -File run_tms_automation.ps1
          $cmd = 'cd D:\appium_project; powershell -ExecutionPolicy Bypass -File run_tms_automation.ps1'
          $p = Start-Process powershell.exe `
                    -WorkingDirectory 'D:\appium_project' `
                    -ArgumentList '-NoProfile','-ExecutionPolicy','Bypass','-Command', $cmd `
                    -WindowStyle Normal -PassThru

          $p.WaitForExit()
          if ($p.ExitCode -ne 0) { throw "run_tms_automation.ps1 exited with code $($p.ExitCode)" }
