name: TMS PS1 Only (Visible)

on:
  workflow_dispatch: {}     # 수동 실행 → 즉시 1회 실행
  schedule:
    - cron: "*/30 * * * *"  # 매 30분마다 실행(UTC 기준)

concurrency:
  group: tms-ps1-only
  cancel-in-progress: true

jobs:
  run-local-ps1:
    runs-on: [self-hosted, Windows]
    defaults:
      run:
        shell: powershell

    steps:
      - name: Run local PS1 in a VISIBLE PowerShell window (exact commands)
        run: |
          # 1차 실행: D:\appium_project
          $cmd1 = 'cd D:\appium_project; powershell -ExecutionPolicy Bypass -File run_tms_automation.ps1'
          $p = Start-Process powershell.exe `
                    -WorkingDirectory 'D:\appium_project' `
                    -ArgumentList '-NoProfile','-ExecutionPolicy','Bypass','-Command', $cmd1 `
                    -WindowStyle Normal -PassThru

          $p.WaitForExit()
          if ($p.ExitCode -ne 0) {
            throw "run_tms_automation.ps1 (D:\appium_project) exited with code $($p.ExitCode)"
          }

          # 2차 실행: D:\appium_project\stamp
          $cmd2 = 'cd D:\appium_project\stamp; powershell -ExecutionPolicy Bypass -File run_tms_automation.ps1'
          $p2 = Start-Process powershell.exe `
                    -WorkingDirectory 'D:\appium_project\stamp' `
                    -ArgumentList '-NoProfile','-ExecutionPolicy','Bypass','-Command', $cmd2 `
                    -WindowStyle Normal -PassThru

          $p2.WaitForExit()
          if ($p2.ExitCode -ne 0) {
            throw "run_tms_automation.ps1 (D:\appium_project\stamp) exited with code $($p2.ExitCode)"
          }
